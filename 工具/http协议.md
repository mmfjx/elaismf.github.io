# Http协议

## 1. TCP/IP协议簇

TCP/IP分层管理：

* 应用层、传输层、网络层、数据链路层
* 层次化管理，分工明确可替换

### 1.1 应用层

决定了向用户提供应用服务时通信的活动，比如：FTP(File Transfer Protocol, 文件传输协议)、DNS(Domain Name System, 域名系统)、HTTP协议。

### 1.2 传输层

对上层应用层，提供处于网络连接中的两台计算机之间的数据传输，包含两个协议：TCP(Transmission Control Protocol, 传输控制协议)和UDP(User Data Protocol, 用户数据报协议)。
### 1.3 网络层（网络互连层）

处理在网络上流动的数据包（数据包是网络传输的最小数据单位），同时负责传输路线，在众多的选项中选择一条传输路线。

### 1.4 数据链路层（网络接口层）

处理连接网络的硬件部分，包括控制操作系统、硬件的设备驱动，NIC(Network Interface Card, 网络适配器，即网卡)，及光纤等物理可见部分（还包括链接器等一切传输媒介），硬件上的范畴均在链路层的作用范围之内。

### 1.3. TCP/IP 通信传输流


![TCP/IP 通信传输流](./img/tcp1.png)

举例：

1. 发送端的客户端在应用层发出Http请求
2. 在传输层（TCP）协议把从应用层收到的数据（HTTP报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层
3. 在网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层

![TCP/IP数据传输](./img/tcp2.png)

发送端在层与层之间传输数据时，每经过一层会被打上一个该层所属的首部信息，反之，接收层在层与层传输数据时，每经过一层时会把对应的首部消去

### 1.4 IP、TCP、DNS

#### 负责传输的IP协议
IP(Internet protocol， 网际协议)属于网络层，负责把各种数据包传输给对方，依赖IP地址和MAC地址（Media Access Control Address）.

* IP地址指明了节点被分配到的地址（可变换）
* MAC地址是指网卡所属的固定地址（基本上不会更改）

IP地址可以和MAC地址进行配对。
ARP(Address Resolution Protocol)是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

为了把数据传输给对方，需要经过很多计算机和网络设备中转才能连接到对方，这个过程叫路由选择，类似于快递公司的送货过程。
**无论哪台计算机、哪台网络设备，都无法全面掌握互联网中的细节**

![IP](./img/ip.png)

#### 确保可靠性的TCP协议
TCP位于传输层，提供可靠的字节流服务。

* 字节流服务：为了方便传输，讲大块数据分割成以报文段为单位的数据包进行管理

总之，TCP协议为了更容易传送大数据会把数据分割，而且能够确认数据最终是否送达到对方。
##### 确保数据到达目标

 **三次握手**

![tcp](./img/tcp-三次握手.png)
如果中途莫名中断，会再次以相同的顺序发送相同的数据包

#### 负责域名解析的DNS服务
DNS位于应用层，通过域名到IP地址之间的解析服务
![tcp](./img/dns.png)

#### 各种协议与HTTP协议的关系
![tcp](./img/1.png)

### HTTP状态
* http协议是无状态的，每次http请求不会保存请求的内容
* 持久链接：keep-live:一旦建立TCP连接，除非有一端明确提出断开连接，否则保持TCP连接状态，即建立一次TCP连接后可以进行多次请求和响应的交互，但是，只能等上一个请求响应之后，才能发送下一个请求。
* 管道化（pipelining）方式：可以做到同时并行发送多个请求，而不需要一个接一个地等待响应。

#### 响应状态码

* 1XX  请求正在处理
* 2XX  请求响应成功
* 3XX  请求重定向
	* 301 Moved Permeanently 永久重定向
	* 302 Found 临时重定向，只是告诉你已经变了
	* 303 see other 临时重定向，但提示你按照新的方式访问
	* 304 Not Modified 允许请求，但是不符合条件
* 4XX  客户端请求错误
	* 400 Bad Request 请求语法错误
	* 401 Unauthorized 请求无权限
	* 403 Frobidden 拒绝响应
	* 404 Not Found  无法找到请求的资源
* 5XX  服务端响应错误
	* 500 Internet Server Error 服务端请求执行时发生了错误
	* 503 Seriver Unavailable	服务器暂时处于超负载或正在进行停机维护中，现在服务处理请求

#### HTTP首部字段

 ![tcp](./img/报文结构.png)
* 报文首部：HTTP 协议的请求和响应报文中必定包含 HTTP 首部。首部内容为 客户端和服务器分别处理请求和响应提供所需要的信息。对于客户端用 户来说，这些信息中的大部分内容都无须亲自查看。使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用 的语言、认证信息等内容。

 ![tcp](./img/请求报文.png)
 ![tcp](./img/相应报文.png)
 * 4种HTTP首部字段类型
   * 通用首部字段(General●Header●Fields)：请求报文和响应报文两方都会使用的首部。
   * 请求首部字段(Request●Header●Fields)：从客户端向服务器端发送请求报文时使用的首部。补充了请求的附 加内容、客户端信息、响应内容相关优先级等信息。
   * 响应首部字段(Response●Header●Fields)：从服务器端向客户端返回响应报文时使用的首部。补充了响应的附 加内容，也会要求客户端附加额外的内容信息。
   * 实体首部字段(Entity●Header●Fields)：针对请求报文和响应报文的实体部分使用的首部。补充了资源内容 更新时间等与实体有关的信息。

#### HTTPS

![tcp](./img/https.png)
HTTP+ 加密 + 认证 + 完整性保护 =HTTPS
![tcp](./img/https1.png)
HTTPS 是身披 SSL 外壳的 HTTP

* 对称密钥加密: 加密和解密同用一个密钥的方式称为共享密钥加密
* 非对称密钥加密：公开密钥加密，私有密钥解密
* HTTPS采用混合加密机制: HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机 制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密 来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。
所以应充分利用两者各自的优势，将多种方法组合起来用于通信。 在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段 则使用共享密钥加密方式。

![tcp](./img/https2.png)

* HTTPS 的安全通信机制
![tcp](./img/https4.png)
![tcp](./img/https5.png)
![tcp](./img/https6.png)
* HTTPS 使 用 SSL(Secure Socket Layer) 和 TLS(Transport Layer Security)这两个协议。
![tcp](./img/ssl.png)

